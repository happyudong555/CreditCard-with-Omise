{"version":3,"file":"static/webpack/static/development/pages/index.js.2e853e8f2601910728df.hot-update.js","sources":["webpack:///./components/shoppingCart.js"],"sourcesContent":["// module\nimport React from 'react'\nimport Head from 'next/head'\nimport CartItem from '../components/CartItem'\nimport Script from 'react-load-script'\nimport axios from 'axios'\n// database\nimport firebaseAppDB from '../static/connectServer/firebase_server'\nconst database = firebaseAppDB.firestore()\nlet OmiseCard;\nexport default class ShoppingCart extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            item: [],\n            total: []\n        }\n    }\n    componentDidMount() {\n        database.collection(\"cart\").onSnapshot((snapshot) => {\n            snapshot.docChanges().forEach((ChangeData) => {\n                if (ChangeData.type === \"added\") {\n                    let json = ChangeData.doc.data();\n                    this.state.item.push(json);\n                    let price = ChangeData.doc.data().total;\n                    this.state.total.push(price)\n                }\n                else if (ChangeData.type === \"removed\") {\n                    // clear value\n                    let New_price = ChangeData.doc.data().total;\n                    console.log(New_price)\n                }\n            });\n            this.setState({\n                item: this.state.item\n            })\n            this.setState({\n                total: this.state.total\n            })\n        });\n\n    }\n    LoadScript = () => {\n        OmiseCard = window.OmiseCard\n        OmiseCard.configure({\n            publicKey: 'pkey_test_5g3s89m0e7gk63jo17o',\n            currency: 'thb',\n            frameLabel: 'I-shop',\n            submitLabel: 'PAY NOW',\n            buttonLabel: 'Pay with Omise'\n        });\n    }\n    CreditCard_config = () => {\n        OmiseCard.configure({\n            defaultPaymentMethod: 'credit_card',\n            otherPaymentMethods: []\n        });\n        OmiseCard.configureButton('#credit_card');\n        OmiseCard.attach();\n    }\n    OmiseToken = () => {\n        let book_name = this.state.item.map((item)=> item.book_name)\n        let price = this.state.total;\n        let total = (price.reduce((sum, price) => sum += price, 0) * 100)\n        OmiseCard.open({\n            frameDescription: 'Invoice #3847',\n            amount: total,\n            onCreateTokenSuccess: (token) => {\n                //API server here\n                axios({\n                    method: 'post',\n                    url: '/pay',\n                    data: {\n                        book_name,\n                        total,\n                        token\n                    },\n                    headers: {\n                        \"Content-Type\": \"application/json\"\n                    }\n                });\n            },\n            onFormClosed: () => {\n                /* Your handler when form was closed */\n            },\n        })\n    }\n    pay = (e) => {\n        e.preventDefault();\n        this.CreditCard_config();\n        this.OmiseToken();\n    }\n    render() {\n        let price = this.state.total;\n        let total = price.reduce((sum, price) => sum += price, 0)\n        return (\n            <div>\n                <Script\n                    url=\"https://cdn.omise.co/omise.js\"\n                    onLoad={this.LoadScript.bind(this)}\n                />\n                <div className=\"modal fade\" id=\"shoppingCart\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n                    <div className=\"modal-dialog\" role=\"document\">\n                        <div className=\"modal-content\">\n                            <div className=\"modal-header\">\n                                <h5 style={{ marginLeft: 10 }} className=\"modal-title\"\n                                    id=\"exampleModalLabel\">\n                                    Shopping Cart\n                            </h5>\n                                <button type=\"button\" className=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                                    <span aria-hidden=\"true\">&times;</span>\n                                </button>\n                            </div>\n                            <div className=\"modal-body\">\n                                <br />\n                                {\n                                    this.state.item.map((product) => (\n                                        <CartItem\n                                            cover={product.cover}\n                                            book_name={product.book_name}\n                                            quantity={product.quantity}\n                                            price={product.price}\n                                            total={product.total}\n                                            category={product.category} />\n                                    ))\n                                }\n                            </div>\n                            <div className=\"paymentform\">\n                                <h6 className=\"page-header\">{'Total : ' + total + \" THB\"}</h6>\n                                <br />\n                                <form>\n                                    <input onClick={this.pay.bind(this)} value=\"PAY NOW\" type=\"button\" id=\"credit_card\"\n                                        style={{ borderRadius: 0 }}\n                                        className=\"btn btn-block btn-pay\" />\n                                </form>\n                            </div>\n                        </div>\n                    </div>\n                    <style>{`\n                    .paymentform {\n                        width: 100%;\n                        height: auto;\n                        border-top: 1px solid #ddd;\n                        padding:23px;\n                    }\n                    .btn-pay {\n                        height: 38px !important;\n                        background-color: #ffb916;\n                        color: #fff !important;\n                        font-weight:bold;\n                    }\n                `}</style>\n                </div>\n            </div>\n        )\n    }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AACA;AAFA;AAgCA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AAzCA;AA0CA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAjDA;AAkDA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AADA;AARA;AAYA;AACA;AACA;AACA;AApBA;AAsBA;AACA;AA5EA;AA6EA;AACA;AAAA;AACA;AAAA;AACA;AACA;AA/EA;AACA;AACA;AAFA;AAFA;AAMA;AACA;;;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AACA;AAEA;AACA;AADA;AAGA;AAEA;;;AAmDA;AACA;AACA;AAAA;AAAA;AACA;AAGA;AACA;AAFA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AADA;AAIA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAGA;AAAA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AADA;AAWA;AAAA;AACA;AAAA;AAGA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAFA;AAwBA;;;;AAjJA;AACA;;;;;A","sourceRoot":""}