{"ast":null,"code":"import _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\n// module\nimport React from 'react';\nimport Head from 'next/head';\nimport CartItem from '../components/CartItem';\nimport Script from 'react-load-script';\nimport axios from 'axios'; // database\n\nimport firebaseAppDB from '../static/connectServer/firebase_server';\nvar database = firebaseAppDB.firestore();\nvar OmiseCard;\n\nvar ShoppingCart =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(ShoppingCart, _React$Component);\n\n  function ShoppingCart(props) {\n    var _this;\n\n    _classCallCheck(this, ShoppingCart);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ShoppingCart).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"LoadScript\", function () {\n      OmiseCard = window.OmiseCard;\n      OmiseCard.configure({\n        publicKey: 'pkey_test_5g3s89m0e7gk63jo17o',\n        currency: 'thb',\n        frameLabel: 'I-shop',\n        submitLabel: 'PAY NOW',\n        buttonLabel: 'Pay with Omise'\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"CreditCard_config\", function () {\n      OmiseCard.configure({\n        defaultPaymentMethod: 'credit_card',\n        otherPaymentMethods: []\n      });\n      OmiseCard.configureButton('#credit_card');\n      OmiseCard.attach();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"OmiseToken\", function () {\n      var book_name = _this.state.item.map(function (item) {\n        return item.book_name;\n      });\n\n      var price = _this.state.total;\n      var total = price.reduce(function (sum, price) {\n        return sum += price;\n      }, 0) * 100;\n      OmiseCard.open({\n        frameDescription: 'Invoice #3847',\n        amount: total,\n        onCreateTokenSuccess: function onCreateTokenSuccess(token) {\n          //API server\n          axios({\n            method: 'post',\n            url: '/pay',\n            data: {\n              book_name: book_name,\n              total: total,\n              token: token\n            },\n            headers: {\n              \"Content-Type\": \"application/json\"\n            }\n          });\n        },\n        onFormClosed: function onFormClosed() {\n          /* Your handler when form was closed */\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"pay\", function (e) {\n      e.preventDefault();\n\n      _this.CreditCard_config();\n\n      _this.OmiseToken();\n    });\n\n    _this.state = {\n      item: [],\n      total: []\n    };\n    return _this;\n  }\n\n  _createClass(ShoppingCart, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      database.collection(\"cart\").onSnapshot(function (snapshot) {\n        snapshot.docChanges().forEach(function (ChangeData) {\n          if (ChangeData.type === \"added\") {\n            var json = ChangeData.doc.data();\n\n            _this2.state.item.push(json);\n\n            var _price = ChangeData.doc.data().total;\n\n            _this2.state.total.push(_price);\n          }\n        });\n\n        _this2.setState({\n          item: _this2.state.item\n        });\n\n        var price = _this2.state.total;\n        console.log(price);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var price = this.state.total;\n      var total = price.reduce(function (sum, price) {\n        return sum += price;\n      }, 0);\n      return React.createElement(\"div\", null, React.createElement(Script, {\n        url: \"https://cdn.omise.co/omise.js\",\n        onLoad: this.LoadScript.bind(this)\n      }), React.createElement(\"div\", {\n        className: \"modal fade\",\n        id: \"shoppingCart\",\n        tabindex: \"-1\",\n        role: \"dialog\",\n        \"aria-labelledby\": \"exampleModalLabel\",\n        \"aria-hidden\": \"true\"\n      }, React.createElement(\"div\", {\n        className: \"modal-dialog\",\n        role: \"document\"\n      }, React.createElement(\"div\", {\n        className: \"modal-content\"\n      }, React.createElement(\"div\", {\n        className: \"modal-header\"\n      }, React.createElement(\"h5\", {\n        style: {\n          marginLeft: 10\n        },\n        className: \"modal-title\",\n        id: \"exampleModalLabel\"\n      }, \"Shopping Cart\"), React.createElement(\"button\", {\n        type: \"button\",\n        className: \"close\",\n        \"data-dismiss\": \"modal\",\n        \"aria-label\": \"Close\"\n      }, React.createElement(\"span\", {\n        \"aria-hidden\": \"true\"\n      }, \"\\xD7\"))), React.createElement(\"div\", {\n        className: \"modal-body\"\n      }, React.createElement(\"br\", null), this.state.item.map(function (product) {\n        return React.createElement(CartItem, {\n          cover: product.cover,\n          book_name: product.book_name,\n          quantity: product.quantity,\n          price: product.price,\n          total: product.total,\n          category: product.category\n        });\n      })), React.createElement(\"div\", {\n        className: \"paymentform\"\n      }, React.createElement(\"h6\", {\n        className: \"page-header\"\n      }, 'Total : ' + total + \" THB\"), React.createElement(\"br\", null), React.createElement(\"form\", null, React.createElement(\"input\", {\n        onClick: this.pay.bind(this),\n        value: \"PAY NOW\",\n        type: \"button\",\n        id: \"credit_card\",\n        style: {\n          borderRadius: 0\n        },\n        className: \"btn btn-block btn-pay\"\n      }))))), React.createElement(\"style\", null, \"\\n                    .paymentform {\\n                        width: 100%;\\n                        height: auto;\\n                        border-top: 1px solid #ddd;\\n                        padding:23px;\\n                    }\\n                    .btn-pay {\\n                        height: 38px !important;\\n                        background-color: #ffb916;\\n                        color: #fff !important;\\n                        font-weight:bold;\\n                    }\\n                \")));\n    }\n  }]);\n\n  return ShoppingCart;\n}(React.Component);\n\nexport { ShoppingCart as default };","map":{"version":3,"sources":["/Users/panjamaponkarnasuta/Desktop/creditCard-api/components/shoppingCart.js"],"names":["React","Head","CartItem","Script","axios","firebaseAppDB","database","firestore","OmiseCard","ShoppingCart","props","window","configure","publicKey","currency","frameLabel","submitLabel","buttonLabel","defaultPaymentMethod","otherPaymentMethods","configureButton","attach","book_name","state","item","map","price","total","reduce","sum","open","frameDescription","amount","onCreateTokenSuccess","token","method","url","data","headers","onFormClosed","e","preventDefault","CreditCard_config","OmiseToken","collection","onSnapshot","snapshot","docChanges","forEach","ChangeData","type","json","doc","push","setState","console","log","LoadScript","bind","marginLeft","product","cover","quantity","category","pay","borderRadius","Component"],"mappings":"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","sourcesContent":["// module\nimport React from 'react'\nimport Head from 'next/head'\nimport CartItem from '../components/CartItem'\nimport Script from 'react-load-script'\nimport axios from 'axios'\n// database\nimport firebaseAppDB from '../static/connectServer/firebase_server'\nconst database = firebaseAppDB.firestore()\nlet OmiseCard;\nexport default class ShoppingCart extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            item: [],\n            total: []\n        }\n    }\n    componentDidMount() {\n        database.collection(\"cart\").onSnapshot((snapshot) => {\n            snapshot.docChanges().forEach((ChangeData) => {\n                if (ChangeData.type === \"added\") {\n                    let json = ChangeData.doc.data();\n                    this.state.item.push(json);\n                    let price = ChangeData.doc.data().total;\n                    this.state.total.push(price)\n                }\n            });\n            this.setState({\n                item: this.state.item\n            })\n            let price = this.state.total\n            console.log(price)\n        });\n    }\n    LoadScript = () => {\n        OmiseCard = window.OmiseCard\n        OmiseCard.configure({\n            publicKey: 'pkey_test_5g3s89m0e7gk63jo17o',\n            currency: 'thb',\n            frameLabel: 'I-shop',\n            submitLabel: 'PAY NOW',\n            buttonLabel: 'Pay with Omise'\n        });\n    }\n    CreditCard_config = () => {\n        OmiseCard.configure({\n            defaultPaymentMethod: 'credit_card',\n            otherPaymentMethods: []\n        });\n        OmiseCard.configureButton('#credit_card');\n        OmiseCard.attach();\n    }\n    OmiseToken = () => {\n        let book_name = this.state.item.map((item) => item.book_name)\n        let price = this.state.total;\n        let total = (price.reduce((sum, price) => sum += price, 0) * 100)\n        OmiseCard.open({\n            frameDescription: 'Invoice #3847',\n            amount: total,\n            onCreateTokenSuccess: (token) => {\n                //API server\n                axios({\n                    method: 'post',\n                    url: '/pay',\n                    data: {\n                        book_name,\n                        total,\n                        token\n                    },\n                    headers: {\n                        \"Content-Type\": \"application/json\"\n                    }\n                });\n            },\n            onFormClosed: () => {\n                /* Your handler when form was closed */\n            },\n        })\n    }\n    pay = (e) => {\n        e.preventDefault();\n        this.CreditCard_config();\n        this.OmiseToken();\n    }\n    render() {\n        let price = this.state.total;\n        let total = price.reduce((sum, price) => sum += price, 0)\n        return (\n            <div>\n                <Script\n                    url=\"https://cdn.omise.co/omise.js\"\n                    onLoad={this.LoadScript.bind(this)}\n                />\n                <div className=\"modal fade\" id=\"shoppingCart\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n                    <div className=\"modal-dialog\" role=\"document\">\n                        <div className=\"modal-content\">\n                            <div className=\"modal-header\">\n                                <h5 style={{ marginLeft: 10 }} className=\"modal-title\"\n                                    id=\"exampleModalLabel\">\n                                    Shopping Cart\n                            </h5>\n                                <button type=\"button\" className=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                                    <span aria-hidden=\"true\">&times;</span>\n                                </button>\n                            </div>\n                            <div className=\"modal-body\">\n                                <br />\n                                {\n                                    this.state.item.map((product) => (\n                                        <CartItem\n                                            cover={product.cover}\n                                            book_name={product.book_name}\n                                            quantity={product.quantity}\n                                            price={product.price}\n                                            total={product.total}\n                                            category={product.category} />\n                                    ))\n                                }\n                            </div>\n                            <div className=\"paymentform\">\n                                <h6 className=\"page-header\">{'Total : ' + total + \" THB\"}</h6>\n                                <br />\n                                <form>\n                                    <input onClick={this.pay.bind(this)} value=\"PAY NOW\" type=\"button\" id=\"credit_card\"\n                                        style={{ borderRadius: 0 }}\n                                        className=\"btn btn-block btn-pay\" />\n                                </form>\n                            </div>\n                        </div>\n                    </div>\n                    <style>{`\n                    .paymentform {\n                        width: 100%;\n                        height: auto;\n                        border-top: 1px solid #ddd;\n                        padding:23px;\n                    }\n                    .btn-pay {\n                        height: 38px !important;\n                        background-color: #ffb916;\n                        color: #fff !important;\n                        font-weight:bold;\n                    }\n                `}</style>\n                </div>\n            </div>\n        )\n    }\n}"]},"metadata":{},"sourceType":"module"}